"use client";

import React, { useRef, useMemo } from "react";
import { useFrame, useLoader } from "@react-three/fiber";
import { Sphere, Circle, Text } from "@react-three/drei";
import { useTheme } from "next-themes";
import * as THREE from "three";

// Technology data with proper SVG icons
const technologies = [
  { 
    name: "JavaScript", 
    icon: `<svg viewBox="0 0 24 24" fill="#F7DF1E"><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"/></svg>`,
    color: "#F7DF1E"
  },
  { 
    name: "TypeScript", 
    icon: `<svg viewBox="0 0 24 24" fill="#3178C6"><path d="M1.125 0C.502 0 0 .502 0 1.125v21.75C0 23.498.502 24 1.125 24h21.75c.623 0 1.125-.502 1.125-1.125V1.125C24 .502 23.498 0 22.875 0zm17.363 9.75c.612 0 1.154.037 1.627.111a6.38 6.38 0 0 1 1.306.34v2.458a3.95 3.95 0 0 0-.643-.361 5.093 5.093 0 0 0-.717-.26 5.453 5.453 0 0 0-1.426-.2c-.3 0-.573.028-.819.086a2.1 2.1 0 0 0-.623.242c-.17.104-.3.229-.393.374a.888.888 0 0 0-.14.49c0 .196.053.373.156.529.104.156.252.304.443.444s.423.276.696.41c.273.135.582.274.926.416.47.197.892.407 1.266.628.374.222.695.473.963.753.268.279.472.598.614.957.142.359.214.776.214 1.253 0 .657-.125 1.21-.373 1.656a3.033 3.033 0 0 1-1.012 1.085 4.38 4.38 0 0 1-1.487.596c-.566.12-1.163.18-1.79.18a9.916 9.916 0 0 1-1.84-.164 5.544 5.544 0 0 1-1.512-.493v-2.63a5.033 5.033 0 0 0 3.237 1.2c.333 0 .624-.03.872-.09.249-.06.456-.144.623-.25.166-.108.29-.234.373-.38a1.023 1.023 0 0 0-.074-1.089 2.12 2.12 0 0 0-.537-.5 5.597 5.597 0 0 0-.807-.444 27.72 27.72 0 0 0-1.007-.436c-.918-.383-1.602-.852-2.053-1.405-.45-.553-.676-1.222-.676-2.005 0-.614.123-1.141.369-1.582.246-.441.58-.804 1.004-1.089a4.494 4.494 0 0 1 1.47-.629 7.536 7.536 0 0 1 1.77-.201zm-15.113.188h9.563v2.166H9.506v9.646H6.789v-9.646H3.375z"/></svg>`,
    color: "#3178C6"
  },
  { 
    name: "React", 
    icon: `<svg viewBox="0 0 24 24" fill="#61DAFB"><path d="M14.23 12.004a2.236 2.236 0 0 1-2.235 2.236 2.236 2.236 0 0 1-2.236-2.236 2.236 2.236 0 0 1 2.235-2.236 2.236 2.236 0 0 1 2.236 2.236zm2.648-10.69c-1.346 0-3.107.96-4.888 2.622-1.78-1.653-3.542-2.602-4.887-2.602-.41 0-.783.093-1.106.278-1.375.793-1.683 3.264-.973 6.365C1.98 8.917 0 10.42 0 12.004c0 1.59 1.99 3.097 5.043 4.03-.704 3.113-.39 5.588.988 6.38.32.187.69.275 1.102.275 1.345 0 3.107-.96 4.888-2.624 1.78 1.654 3.542 2.603 4.887 2.603.41 0 .783-.09 1.106-.275 1.374-.792 1.683-3.263.973-6.365C22.02 15.096 24 13.59 24 12.004c0-1.59-1.99-3.097-5.043-4.032.704-3.11.39-5.587-.988-6.38-.318-.184-.688-.277-1.092-.278zm-.005 1.09v.006c.225 0 .406.044.558.127.666.382.955 1.835.73 3.704-.054.46-.142.945-.25 1.44a23.476 23.476 0 0 0-3.107-.534A23.892 23.892 0 0 0 12.769 4.7c1.592-1.48 3.087-2.292 4.105-2.295zm-9.77.02c1.012 0 2.514.808 4.11 2.28-.686.72-1.37 1.537-2.02 2.442a22.73 22.73 0 0 0-3.113.538 15.02 15.02 0 0 1-.254-1.42c-.23-1.868.054-3.32.714-3.707.19-.09.4-.127.563-.132zm4.882 3.05c.455.468.91.992 1.36 1.564-.44-.02-.89-.034-1.36-.034-.47 0-.92.01-1.36.034.44-.572.895-1.096 1.36-1.564zM12 8.1c.74 0 1.477.034 2.202.093.406.582.802 1.203 1.183 1.86.372.64.71 1.29 1.018 1.946-.308.655-.646 1.31-1.013 1.95-.38.66-.773 1.288-1.18 1.87a25.64 25.64 0 0 1-4.412.005 26.64 26.64 0 0 1-1.183-1.86c-.372-.64-.71-1.29-1.018-1.946a25.17 25.17 0 0 1 1.013-1.954c.38-.66.773-1.286 1.18-1.868A25.245 25.245 0 0 1 12 8.098zm-3.635.254c-.24.377-.48.763-.704 1.16-.225.39-.435.782-.635 1.174-.265-.656-.49-1.31-.676-1.947.64-.15 1.315-.283 2.015-.386zm7.26 0c.695.103 1.365.23 2.006.387-.18.632-.405 1.282-.66 1.933a25.952 25.952 0 0 0-1.346-2.32zm3.063.675c.484.15.944.317 1.375.498 1.732.74 2.852 1.708 2.852 2.476-.005.768-1.125 1.74-2.857 2.475-.42.18-.88.342-1.355.493a23.966 23.966 0 0 0-1.1-2.98c.45-1.017.81-2.01 1.085-2.964zm-13.395.004c.278.96.645 1.957 1.1 2.98a23.142 23.142 0 0 0-1.086 2.964c-.484-.15-.944-.318-1.37-.5-1.732-.737-2.852-1.706-2.852-2.474 0-.768 1.12-1.742 2.852-2.476.42-.18.88-.342 1.356-.494zm11.678 4.28c.265.657.49 1.312.676 1.948-.64.157-1.316.29-2.016.39a25.819 25.819 0 0 0 1.341-2.338zm-9.945.02c.2.392.41.783.64 1.175.23.39.465.772.705 1.143a22.005 22.005 0 0 1-2.006-.386c.18-.63.406-1.282.66-1.933zM17.92 16.32c.112.493.2.968.254 1.423.23 1.868-.054 3.32-.714 3.708-.147.09-.338.128-.563.128-1.012 0-2.514-.807-4.11-2.28.686-.72 1.37-1.536 2.02-2.44 1.107-.118 2.154-.3 3.113-.54zm-11.83.01c.96.234 2.006.415 3.107.532.66.905 1.345 1.727 2.035 2.446-1.595 1.483-3.092 2.295-4.11 2.295a1.185 1.185 0 0 1-.553-.132c-.666-.38-.955-1.834-.73-3.703.054-.46.142-.944.25-1.438zm4.56.64c.44.02.89.034 1.36.034.47 0 .92-.01 1.36-.034-.44.572-.895 1.095-1.36 1.56-.465-.467-.92-.988-1.36-1.56z"/></svg>`,
    color: "#61DAFB"
  },
  { 
    name: "Next.js", 
    icon: `<svg viewBox="0 0 24 24" fill="#000000"><path d="M11.5725 0c-.1763 0-.3098.0013-.3584.0067-.0516.0053-.2159.021-.3636.0328-3.4088.3073-6.6017 2.1463-8.624 4.9728C1.1004 6.584.3802 8.3666.1082 10.255c-.0962.659-.108.8537-.108 1.7474s.012 1.0884.108 1.7476c.652 4.506 3.8591 8.2919 8.2087 9.6945.7789.2511 1.6.4223 2.5337.5255.3636.04 1.9354.04 2.299 0 1.6117-.1783 2.9772-.577 4.3237-1.2643.2065-.1056.2464-.1337.2183-.1573-.0188-.0139-.8987-1.1938-1.9543-2.62l-1.919-2.592-2.4047-3.5583c-1.3231-1.9564-2.4117-3.556-2.4211-3.556-.0094-.0026-.0187 1.5787-.0235 3.509-.0067 3.3802-.0093 3.5162-.0516 3.596-.061.115-.108.1618-.2064.2134-.075.0374-.1408.0445-.5429.0445h-.4570607L9.5906 16.7003c-.0529-.0085-.1212-.0339-.1585-.0593-.0593-.0411-.1008-.0976-.1257-.1718l-.0307-.1069-.0051-4.703-.0067-4.7054.0307-.1381c.0342-.1371.0978-.2459.1857-.3151.0531-.0417.1233-.0624.2343-.0624.1429 0 .2241.0323.2946.1221.0374.0483.8633 1.2858 2.1516 3.2222.9304 1.3953 2.3651 3.5583 3.1881 4.8056l1.4967 2.2666.0777-.0513c1.0836-.7141 2.0956-1.6778 2.9005-2.7668C21.3606 16.3808 22.1031 14.0232 22.5351 11.6078c.0962-.659.108-.8537.108-1.7474s-.012-1.0884-.108-1.7476c-.652-4.506-3.8591-8.2919-8.2087-9.6945C13.7012.2522 12.8749.0802 11.8526.0068 11.5725 0 11.5725 0 11.5725 0z"/></svg>`,
    color: "#000000"
  },
  { 
    name: "Node.js", 
    icon: `<svg viewBox="0 0 24 24" fill="#339933"><path d="M11.998,24c-0.321,0-0.641-0.084-0.922-0.247l-2.936-1.737c-0.438-0.245-0.224-0.332-0.08-0.383 c0.585-0.203,0.703-0.25,1.328-0.604c0.065-0.037,0.151-0.023,0.218,0.017l2.256,1.339c0.082,0.045,0.197,0.045,0.272,0l8.795-5.076 c0.082-0.047,0.134-0.141,0.134-0.238V6.921c0-0.099-0.053-0.192-0.137-0.242l-8.791-5.072c-0.081-0.047-0.189-0.047-0.271,0 L3.075,6.68C2.99,6.729,2.936,6.825,2.936,6.921v10.15c0,0.097,0.054,0.189,0.139,0.235l2.409,1.392 c1.307,0.654,2.108-0.116,2.108-0.89V7.787c0-0.142,0.114-0.253,0.256-0.253h1.115c0.139,0,0.255,0.112,0.255,0.253v10.021 c0,1.745-0.95,2.745-2.604,2.745c-0.508,0-0.909,0-2.026-0.551L2.28,18.675c-0.57-0.329-0.922-0.945-0.922-1.604V6.921 c0-0.659,0.353-1.275,0.922-1.603l8.795-5.082c0.557-0.315,1.296-0.315,1.848,0l8.794,5.082c0.570,0.329,0.924,0.944,0.924,1.603 v10.15c0,0.659-0.354,1.273-0.924,1.604l-8.794,5.078C12.643,23.916,12.324,24,11.998,24z M19.099,13.993 c0-1.9-1.284-2.406-3.987-2.763c-2.731-0.361-3.009-0.548-3.009-1.187c0-0.528,0.235-1.233,2.258-1.233 c1.807,0,2.473,0.389,2.747,1.607c0.024,0.115,0.129,0.199,0.247,0.199h1.141c0.071,0,0.138-0.031,0.186-0.081 c0.048-0.054,0.074-0.123,0.067-0.196c-0.177-2.098-1.571-3.076-4.388-3.076c-2.508,0-4.004,1.058-4.004,2.833 c0,1.925,1.488,2.457,3.895,2.695c2.88,0.282,3.103,0.703,3.103,1.269c0,0.983-0.789,1.402-2.642,1.402 c-2.327,0-2.839-0.584-3.011-1.742c-0.02-0.124-0.126-0.215-0.253-0.215h-1.137c-0.141,0-0.254,0.112-0.254,0.253 c0,1.482,0.806,3.248,4.655,3.248C17.501,17.007,19.099,15.91,19.099,13.993z"/></svg>`,
    color: "#339933"
  },
  { 
    name: "Python", 
    icon: `<svg viewBox="0 0 24 24" fill="#3776AB"><path d="M14.25.18l.9.2.73.26.59.3.45.32.34.34.25.34.16.33.1.3.04.26.02.2-.01.13V8.5l-.05.63-.13.55-.21.46-.26.38-.3.31-.33.25-.35.19-.35.14-.33.1-.3.07-.26.04-.21.02H8.77l-.69.05-.59.14-.5.22-.41.27-.33.32-.27.35-.2.36-.15.37-.1.35-.07.32-.04.27-.02.21v3.06H3.17l-.21-.03-.28-.07-.32-.12-.35-.18-.36-.26-.36-.36-.35-.46-.32-.59-.28-.73-.21-.88-.14-1.05-.05-1.23.06-1.22.16-1.04.24-.87.32-.71.36-.57.4-.44.42-.33.42-.24.4-.16.36-.1.32-.05.24-.01h.16l.06.01h8.16v-.83H6.18l-.01-2.75-.02-.37.05-.34.11-.31.17-.28.25-.26.31-.23.38-.2.44-.18.51-.15.58-.12.64-.1.71-.06.77-.04.84-.02 1.27.05zm-6.3 1.98l-.23.33-.08.41.08.41.23.34.33.22.41.09.41-.09.33-.22.23-.34.08-.41-.08-.41-.23-.33-.33-.22-.41-.09-.41.09zm13.09 3.95l.28.06.32.12.35.18.36.27.36.35.35.47.32.59.28.73.21.88.14 1.04.05 1.23-.06 1.23-.16 1.04-.24.86-.32.71-.36.57-.4.45-.42.33-.42.24-.4.16-.36.09-.32.05-.24.02-.16-.01h-8.22v.82h5.84l.01 2.76.02.36-.05.34-.11.31-.17.29-.25.25-.31.24-.38.2-.44.17-.51.15-.58.13-.64.09-.71.07-.77.04-.84.01-1.27-.04-1.07-.14-.9-.2-.73-.25-.59-.3-.45-.33-.34-.34-.25-.34-.16-.33-.1-.3-.04-.25-.02-.2.01-.13v-5.34l.05-.64.13-.54.21-.46.26-.38.3-.32.33-.24.35-.2.35-.14.33-.1.3-.06.26-.04.21-.02.13-.01h5.84l.69-.05.59-.14.5-.21.41-.28.33-.32.27-.35.2-.36.15-.36.1-.35.07-.32.04-.28.02-.21V6.07h2.09l.14.01zm-6.47 14.25l-.23.33-.08.41.08.41.23.33.33.23.41.08.41-.08.33-.23.23-.33.08-.41-.08-.41-.23-.33-.33-.23-.41-.08-.41.08z"/></svg>`,
    color: "#3776AB"
  },
  { 
    name: "PostgreSQL", 
    icon: `<svg viewBox="0 0 24 24" fill="#336791"><path d="M23.111 5.441c-.777-1.031-2.008-1.607-3.466-1.622a7.821 7.821 0 0 0-1.334.117c-.817.14-1.54.378-2.139.705a14.127 14.127 0 0 0-1.481.97 15.91 15.91 0 0 0-1.26 1.122c-.38.378-.726.77-1.034 1.177-.307.407-.576.83-.804 1.27-.228.44-.416.896-.564 1.365-.148.47-.257.952-.326 1.445-.07.493-.1.993-.092 1.496.009.503.06 1.007.154 1.505.095.498.231.99.409 1.472.178.481.398.952.66 1.41.261.458.565.902.91 1.33.345.428.731.839 1.157 1.231.426.393.893.766 1.398 1.119.505.353 1.048.686 1.628.998.58.313 1.196.606 1.846.878.65.272 1.333.524 2.047.756.714.231 1.458.443 2.232.635.774.192 1.577.365 2.407.518.83.154 1.688.289 2.572.405.884.116 1.795.214 2.731.293.936.08 1.897.14 2.88.182.982.042 1.987.065 3.013.069 1.026.004 2.072-.011 3.139-.044 1.067-.033 2.155-.086 3.263-.159l.02-.002z"/></svg>`,
    color: "#336791"
  },
  { 
    name: "MongoDB", 
    icon: `<svg viewBox="0 0 24 24" fill="#47A248"><path d="M17.193 9.555c-1.264-5.58-4.252-7.414-4.573-8.115-.28-.394-.53-.954-.735-1.44-.036.495-.055.685-.523 1.184-.723.566-4.438 3.682-4.74 10.02-.282 5.912 4.27 9.435 4.888 9.884l.07.05A73.49 73.49 0 0111.91 24h.481c.114-1.032.284-2.056.51-3.07.417-.296.604-.463.85-.693a11.342 11.342 0 003.639-8.464c.01-.814-.103-1.662-.197-2.218zm-5.336 8.195s0-8.291.275-8.29c.213 0 .49 10.695.49 10.695-.381-.045-.765-1.76-.765-2.405z"/></svg>`,
    color: "#47A248"
  },
  { 
    name: "TailwindCSS", 
    icon: `<svg viewBox="0 0 24 24" fill="#06B6D4"><path d="M12.001,4.8c-3.2,0-5.2,1.6-6,4.8c1.2-1.6,2.6-2.2,4.2-1.8c0.913,0.228,1.565,0.89,2.288,1.624 C13.666,10.618,15.027,12,18.001,12c3.2,0,5.2-1.6,6-4.8c-1.2,1.6-2.6,2.2-4.2,1.8c-0.913-0.228-1.565-0.89-2.288-1.624 C16.337,6.182,14.976,4.8,12.001,4.8z M6.001,12c-3.2,0-5.2,1.6-6,4.8c1.2-1.6,2.6-2.2,4.2-1.8c0.913,0.228,1.565,0.89,2.288,1.624 C7.666,17.818,9.027,19.2,12.001,19.2c3.2,0,5.2-1.6,6-4.8c-1.2,1.6-2.6,2.2-4.2,1.8c-0.913-0.228-1.565-0.89-2.288-1.624 C10.337,13.382,8.976,12,6.001,12z"/></svg>`,
    color: "#06B6D4"
  },
  { 
    name: "Docker", 
    icon: `<svg viewBox="0 0 24 24" fill="#2496ED"><path d="M13.983 11.078h2.119a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.119a.185.185 0 00-.185.185v1.888c0 .102.083.185.185.185m-2.954-5.43h2.118a.186.186 0 00.186-.186V3.574a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.186m0 2.716h2.118a.187.187 0 00.186-.186V6.29a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.887c0 .102.082.185.185.186m-2.93 0h2.12a.186.186 0 00.184-.186V6.29a.185.185 0 00-.185-.185H8.1a.185.185 0 00-.185.185v1.887c0 .102.083.185.185.186m-2.964 0h2.119a.186.186 0 00.185-.186V6.29a.185.185 0 00-.185-.185H5.136a.186.186 0 00-.186.185v1.887c0 .102.084.185.186.186m5.893 2.715h2.118a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.185m-2.93 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.083.185.185.185m-2.964 0h2.119a.185.185 0 00.185-.185V9.006a.185.185 0 00-.184-.186h-2.12a.186.186 0 00-.186.186v1.887c0 .102.084.185.186.185m-2.92 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.082.185.185.185M23.763 9.89c-.065-.051-.672-.51-1.954-.51-.338.001-.676.03-1.01.087-.248-1.7-1.653-2.53-1.716-2.566l-.344-.199-.226.327c-.284.438-.49.922-.612 1.43-.23.97-.09 1.882.403 2.661-.595.332-1.55.413-1.744.42H.751a.751.751 0 00-.75.748 11.376 11.376 0 00.692 4.062c.545 1.428 1.355 2.48 2.41 3.124 1.18.723 3.1 1.137 5.275 1.137.983.003 1.963-.086 2.93-.266a12.248 12.248 0 003.823-1.389c.98-.567 1.86-1.288 2.61-2.136 1.252-1.418 1.998-2.997 2.553-4.4h.221c1.372 0 2.215-.549 2.68-1.009.309-.293.55-.65.707-1.046l.098-.288z"/></svg>`,
    color: "#2496ED"
  },
  { 
    name: "Redis", 
    icon: `<svg viewBox="0 0 24 24" fill="#DC382D"><path d="M10.5 2.661l.54.997-4.757 2.613 4.757 2.6-.54.997L0 6.84v-.001l10.5-4.178zm2.577.938l4.757 2.6-4.757 2.613.54.997L24 6.84v-.001l-10.5-4.178-.423.938zM0 9.6l10.5 4.178.54-.997-4.757-2.6L10.54 7.58l-.54-.997L0 10.601v-.001zm24 0v.001l-10.5 4.178-.54-.997 4.757-2.6-4.757-2.613.54-.997L24 9.6zM0 12.84l10.5 4.178.54-.997-4.757-2.6 4.757-2.613-.54-.997L0 12.84v.001zm24 0v.001l-10.5 4.178-.54-.997 4.757-2.6-4.757-2.613.54-.997L24 12.84z"/></svg>`,
    color: "#DC382D"
  },
  { 
    name: "Go", 
    icon: `<svg viewBox="0 0 24 24" fill="#00ADD8"><path d="M1.811 10.231c-.047 0-.058-.023-.035-.059l.246-.315c.023-.035.081-.058.128-.058h4.172c.046 0 .058.035.035.07l-.199.303c-.023.036-.082.07-.117.070zM.047 11.306c-.047 0-.059-.023-.035-.058l.245-.316c.023-.035.082-.058.129-.058h5.328c.047 0 .07.035.058.07l-.093.28c-.012.047-.058.07-.105.07zM2.828 12.39c-.047 0-.059-.034-.035-.07l.163-.292c.023-.035.070-.07.117-.07h2.337c.047 0 .070.035.070.082l-.023.28c0 .047-.023.070-.070.070zm8.498-4.703c-.749.18-1.406.568-2.005 1.213l4.016-.27c.399-.741.645-1.619.645-2.548 0-.07-.012-.152-.012-.222 0-.117-.023-.246-.047-.375C12.65 4.438 11.244 3.471 9.239 3.471c-3.016 0-5.093 2.548-5.093 5.951 0 4.005 2.147 6.75 5.02 6.75.070 0 .14-.012.198-.012H24v-4.16l-12.674-.07zm-3.817.07c0-2.004 1.274-3.442 2.942-3.442 1.645 0 2.943 1.438 2.943 3.442 0 2.004-1.298 3.442-2.943 3.442-1.668 0-2.942-1.438-2.942-3.442z"/></svg>`,
    color: "#00ADD8"
  }
];

// Tech icon component with SVG icons rendered as circles
function TechIcon({ position, tech, index }: { position: [number, number, number], tech: any, index: number }) {
  const groupRef = useRef<THREE.Group>(null);
  
  useFrame(({ clock, camera }) => {
    if (groupRef.current) {
      const time = clock.getElapsedTime();
      
      // Individual gentle rotation
      groupRef.current.rotation.z = Math.sin(time * 0.3 + index) * 0.1;
      
      // Subtle floating animation
      const floatOffset = Math.sin(time * 0.4 + index * 0.8) * 0.05;
      groupRef.current.position.set(
        position[0],
        position[1] + floatOffset,
        position[2]
      );
      
      // Face the camera
      groupRef.current.lookAt(camera.position);
    }
  });

  return (
    <group ref={groupRef} position={position}>
      {/* Main technology circle with brand color */}
      <Circle args={[0.35]} position={[0, 0, 0]}>
        <meshBasicMaterial 
          color={tech.color} 
          transparent 
          opacity={1}
          side={THREE.DoubleSide}
        />
      </Circle>
      
      {/* White border circle */}
      <Circle args={[0.38]} position={[0, 0, -0.01]}>
        <meshBasicMaterial 
          color="#FFFFFF" 
          transparent 
          opacity={0.9}
          side={THREE.DoubleSide}
        />
      </Circle>
      
      {/* Technology name text */}
      <Text
        position={[0, 0, 0.01]}
        fontSize={0.08}
        color={tech.name === "Next.js" ? "#FFFFFF" : 
              tech.name === "JavaScript" ? "#000000" :
              "#FFFFFF"}
        anchorX="center"
        anchorY="middle"
        maxWidth={0.6}
        font-weight="bold"
      >
        {tech.name === "JavaScript" ? "JS" :
         tech.name === "TypeScript" ? "TS" :
         tech.name === "React" ? "⚛" :
         tech.name === "Next.js" ? "▲" :
         tech.name === "Node.js" ? "NODE" :
         tech.name === "Python" ? "PY" :
         tech.name === "PostgreSQL" ? "PG" :
         tech.name === "MongoDB" ? "🍃" :
         tech.name === "TailwindCSS" ? "TW" :
         tech.name === "Docker" ? "🐳" :
         tech.name === "Redis" ? "RD" :
         tech.name === "Go" ? "GO" :
         tech.name.slice(0, 2).toUpperCase()}
      </Text>
    </group>
  );
}

export default function CodeSphere() {
  const { resolvedTheme } = useTheme();
  const groupRef = useRef<THREE.Group>(null);
  const isDarkTheme = resolvedTheme === "dark";
  
  // Generate stable positions for each technology
  const techPositions = useMemo(() => {
    return technologies.map((_, idx) => {
      const total = technologies.length;
      const radius = 2.5; // Optimal radius for visibility
      
      // Fibonacci sphere distribution for even spacing
      const y = 1 - (idx / (total - 1)) * 2; // y from 1 to -1
      const radiusAtY = Math.sqrt(1 - y * y);
      const theta = (idx * 2.399963) % (2 * Math.PI); // Golden angle
      
      return [
        radius * radiusAtY * Math.cos(theta),
        radius * y,
        radius * radiusAtY * Math.sin(theta)
      ] as [number, number, number];
    });
  }, []);

  useFrame(({ clock }) => {
    const time = clock.getElapsedTime();
    
    // Gentle rotation of the entire sphere
    if (groupRef.current) {
      groupRef.current.rotation.y = time * 0.08;
      groupRef.current.rotation.x = Math.sin(time * 0.03) * 0.05;
    }
  });

  return (
    <group ref={groupRef} position={[0, 0, 0]}>
      {/* Main wireframe sphere */}
      <Sphere args={[2.2, 24, 24]} position={[0, 0, 0]}>
        <meshBasicMaterial 
          color="#ff6b00"
          wireframe 
          transparent 
          opacity={0.3} 
        />
      </Sphere>
      
      {/* Technology icons */}
      {technologies.map((tech, i) => (
        <TechIcon
          key={tech.name + i}
          position={techPositions[i]}
          tech={tech}
          index={i}
        />
      ))}
      
      {/* Inner glow effect */}
      <Sphere args={[1.9, 20, 20]} position={[0, 0, 0]}>
        <meshBasicMaterial 
          color="#ff6b00"
          transparent 
          opacity={0.08} 
        />
      </Sphere>
      
      {/* Outer boundary sphere */}
      <Sphere args={[2.8, 16, 16]} position={[0, 0, 0]}>
        <meshBasicMaterial 
          color="#ff8c3f"
          wireframe 
          transparent 
          opacity={0.15} 
        />
      </Sphere>
    </group>
  );
}
